generator client {
  provider     = "prisma-client"
  output       = "../src/database/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum FriendStatus {
  PENDING
  ACCEPTED
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  password   String
  firstName  String   @map("first_name")
  lastName   String   @map("last_name")
  dob        DateTime @db.Date
  gender     Gender
  avatarUrl  String?  @map("avatar_url")
  coverUrl   String?  @map("cover_url")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz()
  usersA     Friend[] @relation("userA")
  usersB     Friend[] @relation("userB")
  requesters Friend[] @relation("requester")
}

model Friend {
  id          Int          @id @default(autoincrement())
  userAId     String       @map("user_a_id")
  userBId     String       @map("user_b_id")
  requesterId String       @map("requester_id")
  status      FriendStatus @default(PENDING)
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamptz()
  friendSince DateTime     @updatedAt @map("friend_since") @db.Timestamptz()

  userA     User @relation("userA", fields: [userAId], references: [id], onDelete: Cascade)
  userB     User @relation("userB", fields: [userBId], references: [id], onDelete: Cascade)
  requester User @relation("requester", fields: [requesterId], references: [id], onDelete: Cascade)

  @@unique([userAId, userBId])
}
